#global #if WINDOWS
#global public
#global namespace Sync
using Win32

#[Swag.NoCopy]
struct Event
{
    handle: HANDLE
}

impl Event
{
    func opDrop(using self)
    {
        release()
    }

    // Returns true if the event is valid
    func isValid(using self)->bool
    {
        return handle != null
    }

    // Creates a new event
    func create()->Event
    {
        var result: retval
        result.init()
        return result
    }

    // Initialize event
    func init(using self, manual, initState = false)
    {
        Debug.assert(handle == null)
        handle = assume CreateEventA(null, manual ? TRUE : FALSE, initState ? TRUE : FALSE, null)
    }

    // Destroy an existing event
    func release(using self)
    {
        if !handle do
            return
        CloseHandle(handle)
        handle = null
    }

    // Signal the event
    func signal(using self)
    {
        Debug.assert(isValid())
        assume SetEvent(handle)
    }

    // Reset the event state
    func reset(using self)
    {
        Debug.assert(isValid())
        assume ResetEvent(handle)
    }

    // Wait for the event to be signaled
    func wait(using self)
    {
        Debug.assert(isValid())
        assume WaitForSingleObject(handle, INFINITE)
    }
}