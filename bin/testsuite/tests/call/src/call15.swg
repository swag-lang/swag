#global if #os == Swag.TargetOs.Windows
using tests_foreign

using Swag

#[Swag.Foreign("kernel32")]
{
    func GetModuleHandleA(lpModuleName: const *u8)->const *void;
    func GetProcAddress(hModule: const *void, lpProcName: const *u8)->const *void;
}

//#[Swag.PrintBc, Swag.Optim(false)]
#test
{
    h := GetModuleHandleA(@dataof("tests_foreign"))
    @assert(h != null)
    ptr := GetProcAddress(h, @dataof("tests_foreign.tcf_manualcall"))
    @assert(ptr != null)

    tcf_manualcall := @mkforeign(func(s64)->s64, ptr)
    @assert(tcf_manualcall(10) == 10)
}
